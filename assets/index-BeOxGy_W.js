(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function i(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(r){if(r.ep)return;r.ep=!0;const l=i(r);fetch(r.href,l)}})();const B={HIT_ZONE_PERCENT:.8,NOTE_SPEED:.65,WINDOW_PERFECT:100,WINDOW_GOOD:180},G={EASY:{threshold:.35,goldThreshold:.6,mineChance:0,minInterval:.5},NORMAL:{threshold:.28,goldThreshold:.5,mineChance:.05,minInterval:.35},HARD:{threshold:.18,goldThreshold:.4,mineChance:.1,minInterval:.18}},S={play:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>',pause:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>'};class H{static generate(t,i="NORMAL"){const s=t.getChannelData(0),r=t.sampleRate,l=G[i],c=[];let m=0;for(let d=0;d<s.length;d+=1024){const h=d/r,u=Math.abs(s[d]);if(u>l.threshold&&h-m>l.minInterval){const E=Math.floor(Math.random()*4),C=u>l.goldThreshold,b=u>l.goldThreshold+.15,x=Math.random()>.8&&!b;c.push({id:crypto.randomUUID(),time:h*1e3,lane:E,type:x?"hold":C?"gold":"normal",duration:x?Math.random()*400+200:0,hit:!1,missed:!1,holding:!1}),b&&!x&&c.push({id:crypto.randomUUID(),time:h*1e3,lane:(E+Math.floor(Math.random()*3)+1)%4,type:"normal",duration:0,hit:!1,missed:!1,holding:!1}),m=h}else Math.random()<l.mineChance/50&&h-m>.2&&c.push({id:crypto.randomUUID(),time:h*1e3,lane:Math.floor(Math.random()*4),type:"mine",duration:0,hit:!1,missed:!1,holding:!1})}return c.sort((d,h)=>d.time-h.time)}}class U{constructor(){this.ctx=null,this.buffer=null,this.source=null,this.analyzer=null,this.isSetup=!1}init(){const t=window.AudioContext||window.webkitAudioContext;this.ctx=new t,this.analyzer=this.ctx.createAnalyser(),this.analyzer.fftSize=256,this.analyzer.smoothingTimeConstant=.8,this.isSetup=!0}async loadFile(t){this.isSetup||this.init();const i=await t.arrayBuffer();return this.buffer=await this.ctx.decodeAudioData(i),this.buffer}play(t){return this.ctx.state==="suspended"&&this.ctx.resume(),this.source=this.ctx.createBufferSource(),this.source.buffer=this.buffer,this.source.connect(this.analyzer),this.analyzer.connect(this.ctx.destination),this.source.onended=t,this.source.start(0),this.ctx.currentTime}pause(){this.ctx&&this.ctx.suspend()}resume(){this.ctx&&this.ctx.resume()}stop(){if(this.source){try{this.source.stop()}catch{}this.source.disconnect()}}getAnalysis(){if(!this.analyzer)return{bass:0,mids:0,highs:0,freqData:[]};const t=new Uint8Array(this.analyzer.frequencyBinCount);return this.analyzer.getByteFrequencyData(t),{freqData:t,bass:t.slice(0,4).reduce((i,s)=>i+s,0)/4/255,mids:t.slice(10,20).reduce((i,s)=>i+s,0)/10/255,highs:t.slice(40,60).reduce((i,s)=>i+s,0)/20/255}}}const p=new U;let e={screen:"menu",paused:!1,difficulty:"NORMAL",theme:{primary:"#22d3ee",secondary:"#c084fc",bg:"#050010"},score:0,combo:0,maxCombo:0,health:100,notes:[],particles:[],startTime:0,pauseTime:0,totalPauseDuration:0,activeKeys:new Set,audioFile:null},M,f,o;const K=n=>{let t=0;for(let s=0;s<n.length;s++)t=n.charCodeAt(s)+((t<<5)-t);const i=Math.abs(t%360);return{primary:`hsl(${i}, 80%, 60%)`,secondary:`hsl(${(i+40)%360}, 70%, 50%)`,accent:`hsl(${(i+180)%360}, 90%, 60%)`,bg:`hsl(${i}, 60%, 5%)`}},N=(n,t,i,s="normal")=>{const r=s==="gold"?20:s==="mine"?30:12,l=s==="gold"?8:s==="mine"?10:5;for(let c=0;c<r;c++){const m=Math.PI*2*c/r;e.particles.push({x:n,y:t,vx:Math.cos(m)*(Math.random()*l+2),vy:Math.sin(m)*(Math.random()*l+2),life:1,color:s==="gold"?"#FFD700":s==="mine"?"#ff0000":i,type:s})}},L=(n,t,i)=>{const s=document.getElementById("judgment-container"),r=document.createElement("div");r.className="absolute text-center bounce-text",r.innerHTML=`
        <h2 class="text-6xl font-black italic" style="color: ${t}; text-shadow: 0 0 20px ${t}">${n}</h2>
        <p class="text-xs font-bold uppercase tracking-[1em] mt-2 text-white animate-pulse">${i}</p>
    `,s.appendChild(r),setTimeout(()=>r.remove(),600)};function q(){f=document.getElementById("game-canvas"),o=f.getContext("2d"),D(),window.addEventListener("resize",D),W(),document.getElementById("audio-input").addEventListener("change",Y),document.getElementById("btn-start").addEventListener("click",F),document.getElementById("btn-back").addEventListener("click",j),document.getElementById("btn-pause-header").addEventListener("click",A),document.getElementById("btn-resume").addEventListener("click",A),document.getElementById("btn-quit").addEventListener("click",R),document.getElementById("btn-menu-return").addEventListener("click",R),document.getElementById("btn-retry").addEventListener("click",F),window.addEventListener("keydown",$),window.addEventListener("keyup",$),f.addEventListener("touchstart",Z,{passive:!1})}function D(){f.width=f.parentElement.clientWidth,f.height=f.parentElement.clientHeight}function W(){const n=document.getElementById("difficulty-selector");n.innerHTML="",["EASY","NORMAL","HARD"].forEach(t=>{const i=document.createElement("button");i.className=`py-3 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${e.difficulty===t?"bg-white text-black":"bg-white/5 text-white/40"}`,i.innerText=t,i.onclick=()=>{e.difficulty=t,p.buffer&&(e.notes=H.generate(p.buffer,t),document.getElementById("note-count").innerText=`${e.notes.length} NOTES READY`),W()},n.appendChild(i)})}async function Y(n){const t=n.target.files[0];if(!t)return;document.getElementById("loading-text").classList.remove("hidden"),e.audioFile=t.name,e.theme=K(t.name),document.getElementById("bg-layer").style.backgroundColor=e.theme.bg,document.documentElement.style.setProperty("--primary",e.theme.primary);const i=await p.loadFile(t);e.notes=H.generate(i,e.difficulty),document.getElementById("upload-area").classList.add("hidden"),document.getElementById("ready-area").classList.remove("hidden"),document.getElementById("song-name").innerText=t.name,document.getElementById("note-count").innerText=`${e.notes.length} NOTES READY`,document.getElementById("ready-icon-container").style.borderColor=e.theme.primary,document.getElementById("ready-icon-container").style.color=e.theme.primary}function j(){document.getElementById("upload-area").classList.remove("hidden"),document.getElementById("loading-text").classList.add("hidden"),document.getElementById("ready-area").classList.add("hidden"),document.getElementById("audio-input").value=""}function k(n){e.screen=n,["screen-menu","screen-playing","screen-results"].forEach(i=>{document.getElementById(i).classList.add("hidden")}),document.getElementById(`screen-${n}`).classList.remove("hidden");const t=document.getElementById("btn-pause-header");n==="playing"?t.classList.remove("hidden"):t.classList.add("hidden")}function F(){e.score=0,e.combo=0,e.maxCombo=0,e.health=100,e.particles=[],e.paused=!1,e.totalPauseDuration=0,e.notes.forEach(n=>{n.hit=!1,n.missed=!1,n.holding=!1}),k("playing"),O(),D(),e.startTime=performance.now(),p.play(()=>_()),document.getElementById("app-title").style.backgroundImage=`linear-gradient(to right, ${e.theme.primary}, ${e.theme.secondary})`,document.getElementById("btn-pause-header").innerHTML=S.pause,P()}function _(){cancelAnimationFrame(M),p.stop(),k("results"),document.getElementById("result-score").innerText=e.score.toLocaleString(),document.getElementById("result-combo").innerText=e.maxCombo,document.getElementById("result-combo").style.color=e.theme.primary;let n="F";e.health>80?n="S":e.health>60?n="A":e.health>40?n="B":e.health>0&&(n="C"),document.getElementById("result-rank").innerText=n}function A(){if(e.screen!=="playing")return;e.paused=!e.paused;const n=document.getElementById("overlay-pause"),t=document.getElementById("btn-pause-header");e.paused?(p.pause(),e.pauseTime=performance.now(),cancelAnimationFrame(M),n.classList.remove("hidden"),t.innerHTML=S.play):(p.resume(),e.totalPauseDuration+=performance.now()-e.pauseTime,n.classList.add("hidden"),t.innerHTML=S.pause,P())}function R(){p.stop(),cancelAnimationFrame(M),k("menu")}function O(){document.getElementById("hud-score").innerText=e.score.toLocaleString(),document.getElementById("hud-combo").innerText=e.combo,document.getElementById("hud-combo").style.color=e.combo>0?e.theme.primary:"rgba(255,255,255,0.2)";const n=document.getElementById("hud-health");n.style.width=`${e.health}%`,n.className=`h-full transition-all duration-300 w-full ${e.health<30?"bg-red-500":"bg-green-400"}`,document.getElementById("hud-score-mobile").innerText=e.score.toLocaleString(),document.getElementById("hud-combo-mobile").innerText=e.combo,document.getElementById("hud-combo-mobile").style.color=e.combo>0?e.theme.primary:"white",document.getElementById("hud-health-mobile").style.width=`${e.health}%`,document.getElementById("hud-health-mobile").className=`h-full ${e.health<30?"bg-red-500":"bg-green-400"}`}function $(n){if(e.screen!=="playing"||e.paused){n.key==="Escape"&&A();return}const i={d:0,f:1,j:2,k:3}[n.key.toLowerCase()];i!==void 0&&(n.type==="keydown"&&!e.activeKeys.has(i)?(e.activeKeys.add(i),z(i)):n.type==="keyup"&&e.activeKeys.delete(i))}function Z(n){if(e.screen!=="playing"||e.paused)return;n.preventDefault();const i=f.width/4,s=Array.from(n.touches),r=new Set;s.forEach(l=>{const c=f.getBoundingClientRect(),m=l.clientX-c.left,d=Math.floor(m/i);d>=0&&d<=3&&r.add(d)}),r.forEach(l=>{e.activeKeys.has(l)||z(l)}),e.activeKeys=r}function z(n){const t=performance.now()-e.startTime-e.totalPauseDuration,i=e.notes.find(s=>!s.hit&&!s.missed&&s.lane===n&&Math.abs(s.time-t)<B.WINDOW_GOOD);if(i){if(i.type==="mine")i.hit=!0,e.combo=0,e.health=Math.max(0,e.health-20),L("OUCH!","#f00","Mine!"),N(0,0,"#f00","mine");else{const s=Math.abs(i.time-t),r=f.width,l=f.height,c=r/4,m=n*c+c/2,d=l*B.HIT_ZONE_PERCENT;let u=n===1||n===2?e.theme.primary:e.theme.secondary;i.type==="gold"&&(u="#FFD700"),N(m,d,u,i.type),i.hit=!0;let E=i.type==="gold"?300:100;s<B.WINDOW_PERFECT?(e.score+=E*2+e.combo*10,L(i.type==="gold"?"JACKPOT!":"PERFECT","#fff","Pure!")):(e.score+=E+e.combo*5,L("GOOD",u,"Hit")),e.combo++,e.combo>e.maxCombo&&(e.maxCombo=e.combo)}O()}}function P(){if(e.paused)return;const n=f.width,t=f.height,s=performance.now()-e.startTime-e.totalPauseDuration,{bass:r,mids:l,freqData:c}=p.getAnalysis(),m=o.createLinearGradient(0,0,0,t);m.addColorStop(0,e.theme.bg),m.addColorStop(1,"#000"),o.fillStyle=m,o.fillRect(0,0,n,t),o.fillStyle=e.theme.primary,o.globalAlpha=r*.2,o.fillRect(0,0,n,t),o.globalAlpha=1;const d=n/2,h=t/2,u=Math.min(n,t)*.2*(1+r*.2);o.beginPath(),o.arc(d,h,u,0,Math.PI*2),o.fillStyle=e.theme.secondary,o.fill();const E=40,C=Math.PI*2/E;o.strokeStyle=e.theme.primary,o.lineWidth=4;for(let a=0;a<E;a++){const y=(c[a]||0)/255*100*(.5+r),g=a*C+s*5e-4;o.beginPath(),o.moveTo(d+Math.cos(g)*u,h+Math.sin(g)*u),o.lineTo(d+Math.cos(g)*(u+y),h+Math.sin(g)*(u+y)),o.stroke()}const b=n/4,x=t*B.HIT_ZONE_PERCENT;o.fillStyle="rgba(0,0,0,0.5)",o.fillRect(0,0,n,t),e.activeKeys.forEach(a=>{const I=o.createLinearGradient(0,t,0,0);I.addColorStop(0,e.theme.primary),I.addColorStop(1,"transparent"),o.fillStyle=I,o.globalAlpha=.3,o.fillRect(a*b,0,b,t),o.globalAlpha=1}),o.strokeStyle="white",o.lineWidth=2+r*6,o.beginPath(),o.moveTo(0,x),o.lineTo(n,x),o.stroke(),e.notes.forEach(a=>{const I=B.NOTE_SPEED*(t/800),y=x-(a.time-s)*I;if(y>t+50&&!a.missed&&!a.hit&&(a.type!=="mine"?(a.missed=!0,e.combo=0,e.health=Math.max(0,e.health-10),L("MISS","#888","..."),O()):a.missed=!0),y>-100&&y<t+50){const g=a.lane*b+b/2;let T=a.lane===1||a.lane===2?e.theme.primary:e.theme.secondary;a.type==="gold"&&(T="#FFD700"),a.type==="mine"&&(T="#f00");const w=b*.8,v=t*.06;o.fillStyle=a.missed&&a.type!=="mine"?"#333":T,(!a.hit||a.type==="mine")&&(o.shadowBlur=a.type==="gold"?30:15,o.shadowColor=T,o.beginPath(),a.type==="gold"?(o.moveTo(g,y-v),o.lineTo(g+w/2,y),o.lineTo(g,y+v),o.lineTo(g-w/2,y)):a.type==="mine"?o.arc(g,y,w/3,0,Math.PI*2):o.roundRect(g-w/2,y-v/2,w,v,8),o.fill(),o.shadowBlur=0)}}),e.particles.forEach((a,I)=>{a.x+=a.vx,a.y+=a.vy,a.life-=.05,o.globalAlpha=a.life,o.fillStyle=a.color,o.beginPath(),o.arc(a.x,a.y,a.type==="gold"?6:4,0,Math.PI*2),o.fill(),a.life<=0&&e.particles.splice(I,1)}),o.globalAlpha=1,e.health<=0?_():M=requestAnimationFrame(P)}window.onload=q;
//# sourceMappingURL=index-BeOxGy_W.js.map
